<div class="filter-bg">
  <aside class="sidebar-col">
    <div class="filters-sidebar">
      <h4 class="filter-header h4">Filters</h4>
      <div class="filter-body">
        <div class="filter-block">
          <div class="filter-block-title h5">
            {{ section.settings.collection_heading }}
            <span><i class="fa-solid fa-plus"></i></span>
          </div>
          <div class="filter-block-body" style="display: block;">
            {{ template.suffix }}
            <ul>
              {% for collection in section.settings.collections_list %}
                <li
                  {% if collection.handle == template.suffix %}
                    class="active"
                  {% endif %}
                >
                  <a href="{{ collection.url }}">{{ collection.title }}</a>
                </li>
              {%- endfor -%}
            </ul>
          </div>
        </div>
        <div class="filter-block">
          <div class="filter-block-title h5">
            Material <span><i class="fa-solid fa-plus"></i></span>
          </div>
          <div class="filter-block-body">
            {% assign materials = '' %}

            {% for product in collection.products %}
              {% for variant in product.variants %}
                {% for option_name in product.options_with_values %}
                  {% if option_name.name == 'Material' %}
                    {% assign material_value = variant.options[forloop.index0] %}
                    {% assign materials = materials | append: material_value | append: ',' %}
                  {% endif %}
                {% endfor %}
              {% endfor %}
            {% endfor %}

            {% assign materials = materials | split: ',' | uniq %}

            {% for material in materials %}
              {% unless material == '' %}
                <div class="custom-control custom-checkbox">
                  <input
                    type="checkbox"
                    class="custom-control-input material-filter"
                    id="material-{{ material | handle }}"
                    value="{{ material }}"
                  >
                  <label class="custom-control-label" for="material-{{ material | handle }}">{{ material }}</label>
                </div>
              {% endunless %}
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </aside>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const filterHeader = document.querySelector('.filter-header');
    const filterBody = document.querySelector('.filter-body');

    // Create dropdown icon
    const dropdownIcon = document.createElement('span');
    dropdownIcon.innerHTML = '<i class="fa-solid fa-plus"></i>';
    dropdownIcon.classList.add('filter-toggle');
    filterHeader.prepend(dropdownIcon);

    // Hide filter body initially on small screens
    if (window.innerWidth <= 756) {
      filterBody.style.display = 'none';
    }

    // Toggle filter body on icon click
    dropdownIcon.addEventListener('click', function () {
      if (filterBody.style.display === 'none' || filterBody.style.display === '') {
        filterBody.style.display = 'block';
        dropdownIcon.innerHTML = '<i class="fa-solid fa-minus"></i>';
      } else {
        filterBody.style.display = 'none';
        dropdownIcon.innerHTML = '<i class="fa-solid fa-plus"></i>';
      }
    });

    // Handle material filter logic
    const checkboxes = document.querySelectorAll('.material-filter');
    const products = document.querySelectorAll('#product-list .product-item');

    checkboxes.forEach(function (checkbox) {
      checkbox.addEventListener('change', function () {
        filterProducts();
      });
    });

    function filterProducts() {
      const selectedMaterials = Array.from(checkboxes)
        .filter((cb) => cb.checked)
        .map((cb) => cb.value.toLowerCase());

      products.forEach(function (product) {
        const productMaterials = product.getAttribute('data-materials').toLowerCase();

        if (
          selectedMaterials.length === 0 ||
          selectedMaterials.some((material) => productMaterials.includes(material))
        ) {
          product.style.display = 'block';
        } else {
          product.style.display = 'none';
        }
      });
    }
  });
</script>
<style>
  .filter-toggle {
    display: none;
  }

  @media (max-width: 756px) {
    .filter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-direction: row-reverse;
      margin: 0 !important;
    }
    .filter-toggle {
      display: flex;
    }
    .filter-body {
      margin-top: 15px;
    }
  }
</style>

{% schema %}
{
  "name": "Sidebar",
  "settings": [
    {
      "type": "text",
      "id": "collection_heading",
      "label": "Filter Title",
      "default": "Category"
    },
    {
      "type": "collection_list",
      "id": "collections_list",
      "label": "Choose Collections"
    }
  ]
}
{% endschema %}
