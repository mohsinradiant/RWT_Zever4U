{%- if card_product and card_product != empty -%}
  {%- liquid
    assign ratio = 1
    if card_product.featured_media and media_aspect_ratio == 'portrait'
      assign ratio = 0.8
    elsif card_product.featured_media and media_aspect_ratio == 'adapt'
      assign ratio = card_product.featured_media.aspect_ratio
    endif
    if ratio == 0 or ratio == null
      assign ratio = 1
    endif
  -%}
  <script src="{{ 'wishlist-button.js' | asset_url }}" async></script>
  <div class="ratings position-absolute">
    <!-- <i class="fa-solid fa-star stars text-brand"></i> 4.8 | <span class="light-text">186</span> -->
    {% comment %} <button type="button" style="border: none;background: transparent;" data-product-handle="{{ card_product.handle }}" class="wishlist-btn"> <i class="fa-regular fa-heart"></i> </button> {% endcomment %}
    {%- if show_rating and card_product.metafields.reviews.rating.value != blank -%}
      {% liquid
        assign rating_decimal = 0
        assign decimal = card_product.metafields.reviews.rating.value.rating | modulo: 1
        if decimal >= 0.3 and decimal <= 0.7
          assign rating_decimal = 0.5
        elsif decimal > 0.7
          assign rating_decimal = 1
        endif
      %}
      <div
        class="rating"
        role="img"
        aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: card_product.metafields.reviews.rating.value, rating_max: card_product.metafields.reviews.rating.value.scale_max }}"
      >
        <span
          aria-hidden="true"
          class="rating-star"
          style="--rating: {{ card_product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ card_product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"
        ></span>
      </div>
      <p class="rating-text caption">
        <span aria-hidden="true">
          {{- card_product.metafields.reviews.rating.value }} /
          {{ card_product.metafields.reviews.rating.value.scale_max -}}
        </span>
      </p>
      <p class="rating-count caption">
        <span aria-hidden="true">({{ card_product.metafields.reviews.rating_count }})</span>
        <span class="visually-hidden">
          {{- card_product.metafields.reviews.rating_count }}
          {{ 'accessibility.total_reviews' | t -}}
        </span>
      </p>
    {%- endif -%}
  </div>
  <!-- <a class="wishlist-icon" href="javascript:void(0);"><i class="fa-regular fa-heart"></i></a> -->
  <a class="product-image" href="{{ card_product.url }}">
    {%- if card_product.featured_media -%}
      <img
        src="{{ card_product.featured_media | image_url}}"
        alt="{{ card_product.featured_media.alt | escape }}"
        {% unless lazy_load == false %}
          loading="lazy"
        {% endunless %}
        width="auto"
        height="auto"
      >
    {%- endif -%}
  </a>
  <div class="product-info py-3">
    <p class="product-name">{{ card_product.title | escape }}</p>
    <div class="product-price">
      {{ card_product.price | money_with_currency }}
      {%- if card_product.compare_at_price -%}
        <del> {{ card_product.compare_at_price | money_with_currency }} </del>
      {%- endif -%}
    </div>
  </div>
  {% comment %}
    <div class="addtocart">
      <form method="post" action="/cart/add">
        <input type="hidden" name="id" value="{{ card_product.variants.first.id }}">
        <button type="submit" class="add-cart">Add to Cart</button>
      </form>
    </div>
  {% endcomment %}
  <div class="quick-add no-js-hidden">
    {%- liquid
      assign qty_rules = false
      if card_product.selected_or_first_available_variant.quantity_rule.min > 1 or card_product.selected_or_first_available_variant.quantity_rule.max != null or card_product.selected_or_first_available_variant.quantity_rule.increment > 1
        assign qty_rules = true
      endif
    -%}
    {%- if card_product.variants.size > 1 or qty_rules -%}
      <modal-opener data-modal="#QuickAdd-{{ card_product.id }}">
        <button
          id="{{ product_form_id }}-submit"
          type="submit"
          name="add"
          class="quick-add__submit button button--full-width button--secondary  card--horizontal__quick-add animate-arrow"
          aria-haspopup="dialog"
          aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
          data-product-url="{{ card_product.url }}"
        >
          {{ 'products.product.choose_options' | t }}
          <span class="icon-wrap">
            {{- 'icon-arrow.svg' | inline_asset_content -}}
          </span>
          {%- render 'loading-spinner' -%}
        </button>
      </modal-opener>
      <quick-add-modal id="QuickAdd-{{ card_product.id }}" class="quick-add-modal">
        <div
          role="dialog"
          aria-label="{{ 'products.product.choose_product_options' | t: product_name: card_product.title | escape }}"
          aria-modal="true"
          class="quick-add-modal__content global-settings-popup"
          tabindex="-1"
        >
          <button
            id="ModalClose-{{ card_product.id }}"
            type="button"
            class="quick-add-modal__toggle"
            aria-label="{{ 'accessibility.close' | t }}"
          >
            {{- 'icon-close.svg' | inline_asset_content -}}
          </button>
          <div id="QuickAddInfo-{{ card_product.id }}" class="quick-add-modal__content-info"></div>
        </div>
      </quick-add-modal>
    {%- else -%}
      <product-form data-section-id="{{ section.id }}">
        {%- form 'product',
          card_product,
          id: product_form_id,
          class: 'form',
          novalidate: 'novalidate',
          data-type: 'add-to-cart-form'
        -%}
          <input
            type="hidden"
            name="id"
            value="{{ card_product.selected_or_first_available_variant.id }}"
            class="product-variant-id"
            {% if card_product.selected_or_first_available_variant.available == false %}
              disabled
            {% endif %}
          >
          <button
            id="{{ product_form_id }}-submit"
            type="submit"
            name="add"
            class="quick-add__submit button button--full-width button--secondary card--horizontal__quick-add"
            aria-haspopup="dialog"
            aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
            aria-live="polite"
            data-sold-out-message="true"
            {% if card_product.selected_or_first_available_variant.available == false %}
              disabled
            {% endif %}
          >
            <span>
              {%- if card_product.selected_or_first_available_variant.available -%}
                {{ 'products.product.add_to_cart' | t }}
              {%- else -%}
                {{ 'products.product.sold_out' | t }}
              {%- endif -%}
            </span>
            <span class="sold-out-message hidden">
              {{ 'products.product.sold_out' | t }}
            </span>
            <span class="icon-wrap">
              {{- 'icon-plus.svg' | inline_asset_content -}}
            </span>
            {%- render 'loading-spinner' -%}
          </button>
        {%- endform -%}
      </product-form>
    {%- endif -%}
  </div>
{%- endif -%}
